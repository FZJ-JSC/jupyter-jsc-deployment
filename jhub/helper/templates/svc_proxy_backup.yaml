apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.proxyBackup.name }}-1
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: http
  - name: https
    port: 443
    protocol: TCP
    targetPort: https
  selector:
    release: {{ .Values.proxyBackup.release }}
    component: proxy
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.proxyBackup.name }}-2
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: http
  - name: https
    port: 443
    protocol: TCP
    targetPort: https
  selector:
    release: {{ .Values.proxyBackup.release }}
    component: proxy
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.proxyBackup.name }}-3
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: http
  - name: https
    port: 443
    protocol: TCP
    targetPort: https
  selector:
    release: {{ .Values.proxyBackup.release }}
    component: proxy
  type: ClusterIP

# https://github.com/helm/helm/issues/1311
{{- $root := . -}}
{{ range $k, $v := until (atoi (quote .Values.proxyBackup.numberOfBackups) | default 3) }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ $root.Values.proxyBackup.name }}2-{{ $k }}
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: http
  - name: https
    port: 443
    protocol: TCP
    targetPort: https
  selector:
    release: {{ $root.Values.proxyBackup.release }}
    component: proxy
  type: ClusterIP
{{- end }}