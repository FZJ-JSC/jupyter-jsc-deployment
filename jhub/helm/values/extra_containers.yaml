hub:
  extraContainers:
    - name: maintenance-check
      image: python:3.9-alpine3.16
      imagePullPolicy: Always
      command: ["/bin/sh"]
      args:
        - -c
        - >-
            pip install jsonformatter python-dateutil requests &&
            mkdir -p $OUTPUT_DIR &&
            source /mnt/maintenance/run.sh
      env:
        - name: CUSTOM_CONFIG_PATH
          value: "/mnt/shared-data/git_config/jupyterhub_custom_config.json"
        - name: OUTPUT_DIR
          value: "/mnt/shared-data/maintenance-check"
        - name: LOGGER_NAME
          value: "MaintenanceCheck"
      volumeMounts:
        - name: shared-data
          mountPath: /mnt/shared-data
        - name: maintenance-check
          mountPath: /mnt/maintenance/maintenance_check.py
          subPath: maintenance_check.py
        - name: maintenance-check
          mountPath: /mnt/maintenance/run.sh
          subPath: run.sh
    - name: cleanup-sql
      image: python:3.9-alpine3.16
      imagePullPolicy: Always
      command: ["/bin/sh"]
      args:
        - -c
        - >-
            pip install requests psycopg2-binary &&
            source /mnt/sql/run.sh
      env:
        - name: CUSTOM_CONFIG_PATH
          value: "/mnt/shared-data/git_config/jupyterhub_custom_config.json"
        - name: SLEEP
          value: "30"
        - name: SQL_HOST
          valueFrom:
            secretKeyRef:
              name: postgresql-general
              key: SQL_HOST
        - name: JUPYTERHUB_DATABASE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: postgresql-users-jupyterjsc
              key: JUPYTERHUB_PASSWORD
        - name: UNICOREMGR_JUPYTERHUB_USER_PASS
          valueFrom:
            secretKeyRef:
              name: drf-unicoremgr-passwds
              key: JUPYTERHUB_USER_PASS
              optional: false
        - name: K8SMGRHDFCLOUD_JUPYTERHUB_USER_PASS
          valueFrom:
            secretKeyRef:
              name: drf-k8smgr-passwds 
              key: JUPYTERHUB_USER_PASS
              optional: false
      volumeMounts:
        - name: shared-data
          mountPath: /mnt/shared-data
        - name: cleanup-sql
          mountPath: /mnt/sql/cleanup_sql.py
          subPath: cleanup_sql.py
        - name: cleanup-sql
          mountPath: /mnt/sql/run.sh
          subPath: run.sh
        - name: internal-ssl
          mountPath: /mnt/certs/hub-ca_hub-ca.crt
          subPath: hub-ca_hub-ca.crt
        - name: drf-unicoremgr-certs
          mountPath: /mnt/unicoremgr_certs
        - name: drf-k8smgr-certs
          mountPath: /mnt/k8smgr_certs
    - name: mount-watch
      image: alpine:3.14
      imagePullPolicy: Always
      command: ["/bin/sh"]
      args:
        - -c
        - >-
            apk add bash && /bin/bash /mnt/volumes_mw/mount_watch/..data/run.sh
      volumeMounts:
        - name: shared-data
          mountPath: /mnt/shared-data
        - name:  mount-watch
          mountPath: /mnt/volumes_mw/mount_watch